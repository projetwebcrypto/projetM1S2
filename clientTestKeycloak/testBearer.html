  <html>
      <head>
          <title>Customer View Page</title>
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
          <script type="text/javascript" src="js/jquery-ui/jquery-ui.min.js"></script>
          <script src="keycloak-js-adapter-dist-6.0.1/keycloak.js" type="text/javascript"></script>
      </head>
      <body bgcolor="#E3F6CE">
      
      <p>Goto: <a href="/product-portal">products</a> | <a href="#" onclick="keycloak.logout()">logout</a> | <a href="#" onclick="keycloak.accountManagement()">manage acct</a></p>
      
      User <b id="subject"></b> made this request.
      <p><b>User details (from <span id="profileType"></span>)</b></p>
      <p>Username: <span id="username"></span></p>
      <p>Email: <span id="email"></span></p>
      <p>Full Name: <span id="name"></span></p>
      <p>First: <span id="givenName"></span></p>
      <p>Last: <span id="familyName"></span></p>
      
      <h2>Customer Listing</h2>
      <div id="customers"></div>
      
      <script>
          var keycloak = Keycloak({
  "realm": "jettytest",
  "auth-server-url": "http://192.168.99.100:8081/auth",
  "url": "http://192.168.99.100:8081/auth",
  "clientId": 'customer-portal',
  "ssl-required": "external",
  "resource": "customer-portal",
  "verify-token-audience": true,
  "credentials": {
    "secret": "A completer"
  },
  "use-resource-role-mappings": true,
  "confidential-port": 0,
  "policy-enforcer": {},
  "enable-cors": true
});
      
          var loadData = function () {
              document.getElementById('subject').innerHTML = keycloak.subject;
      
              if (keycloak.idToken) {
                  document.getElementById('profileType').innerHTML = 'IDToken';
                  document.getElementById('username').innerHTML = keycloak.idTokenParsed.preferred_username;
                  document.getElementById('email').innerHTML = keycloak.idTokenParsed.email;
                  document.getElementById('name').innerHTML = keycloak.idTokenParsed.name;
                  document.getElementById('givenName').innerHTML = keycloak.idTokenParsed.given_name;
                  document.getElementById('familyName').innerHTML = keycloak.idTokenParsed.family_name;
              } else {
                  keycloak.loadUserProfile(function() {
                      document.getElementById('profileType').innerHTML = 'Account Service';
                      document.getElementById('username').innerHTML = keycloak.profile.username;
                      document.getElementById('email').innerHTML = keycloak.profile.email;
                      document.getElementById('name').innerHTML = keycloak.profile.firstName + ' ' + keycloak.profile.lastName;
                      document.getElementById('givenName').innerHTML = keycloak.profile.firstName;
                      document.getElementById('familyName').innerHTML = keycloak.profile.lastName;
                  }, function() {
                      document.getElementById('profileType').innerHTML = 'Failed to retrieve user details. Please enable claims or account role';
                  });
              }
      
              var urlc = 'https://192.168.99.100/moncoffre/login';
      
              var req = new XMLHttpRequest();
              req.open('POST', urlc, true);
              req.setRequestHeader('Accept', 'application/json');
              req.setRequestHeader("Content-Type", "application/json");
              req.setRequestHeader('Authorization', 'Bearer ' + keycloak.token);
            //   req.setRequestHeader("Access-Control-Allow-Origin", "*");
            //   req.setRequestHeader("Access-Control-Allow-Credentials", "true");
            //   req.setRequestHeader("Access-Control-Allow-Headers", "Authorization,Accept,Origin,Content-Type,Keep-Alive");
            //   req.setRequestHeader("Access-Control-Allow-Methods", "GET,POST,OPTIONS,PUT,DELETE");
      
              req.onreadystatechange = function () {
                  if (req.readyState == 4) {
                      if (req.status == 200) {
                          var users = JSON.parse(req.responseText);
                          var html = '';
                          for (var i = 0; i < users.length; i++) {
                              html += '<p>' + users[i] + '</p>';
                          }
                          document.getElementById('customers').innerHTML = html;
                          console.log('finished loading data');
                      }
                  }
              }
              data = {"login":"log","bd":"passwords"};
              req.send(JSON.stringify(data));
        //     $.ajax({
        //   type:"POST",
        //   url:urlc,
        //   data:JSON.stringify(data),
        //   dataType:"text",
        //   contentType:"application/json",
        //   // accepts: "*/*",
        //   success:function(json,status){
        //     var myobj = JSON.parse(json);
        //     var html = '';
        //     if (myobj.triplets.length > 0){
        //       for (var i=1; i<myobj.triplets.length; i++){
        //         html += myobj.triplets;
        //       };
        //     };
        //     document.getElementById('customers').innerHTML = html;
        //     console.log('finished loading data');
        //   },
        //   error:function(data,status){console.log("error POST"+data+" status :  "+status);}
        // });
          };
      
          var loadFailure = function () {
              document.getElementById('customers').innerHTML = '<b>Failed to load data.  Check console log</b>';
          };
      
          var reloadData = function () {
              keycloak.updateToken(10)
                      .success(loadData)
                      .error(function() {
                          document.getElementById('customers').innerHTML = '<b>Failed to load data.  User is logged out.</b>';
                      });
          }
      
          keycloak.init({ onLoad: 'login-required' })
              .success(reloadData)
              .error(function(errorData) {
                  document.getElementById('customers').innerHTML = '<b>Failed to load data. Error: ' + JSON.stringify(errorData) + '</b>';
              });
      
      </script>
      
      <br><br>
      <button onclick="reloadData()">Reload data</button>
      </body>
      </html>
      