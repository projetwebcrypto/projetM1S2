<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui/jquery-ui.min.js"></script>
    <script src="keycloak-js-adapter-dist-6.0.1/keycloak.js" type="text/javascript"></script>
    <script>
      function getToken(){
        var keycloak = Keycloak({
  "realm": "jettytest",
  // "auth-server-url": "http://192.168.99.100:8081/auth",
  "ssl-required": "none",
  "url": "http://192.168.99.100:8081/auth",
  // "public-client": true,
  "clientId": 'customer-portal',
  "credentials": {"secret":"A completer"},
  // "confidential-port": 0,
  "enable-cors": true
});
const loadData = () => {
    console.log(keycloak.subject);
    if (keycloak.idToken) {
        document.location.href = "?user="+keycloak.idTokenParsed.preferred_username;
        console.log('IDToken');
        console.log(keycloak.idTokenParsed.preferred_username);
        console.log(keycloak.idTokenParsed.email);
        console.log(keycloak.idTokenParsed.name);
        console.log(keycloak.idTokenParsed.given_name);
        console.log(keycloak.idTokenParsed.family_name);
    } else {
        keycloak.loadUserProfile(function() {
            console.log('Account Service');
            console.log(keycloak.profile.username);
            console.log(keycloak.profile.email);
            console.log(keycloak.profile.firstName + ' ' + keycloak.profile.lastName);
            console.log(keycloak.profile.firstName);
            console.log(keycloak.profile.lastName);
        }, function() {
            console.log('Failed to retrieve user details. Please enable claims or account role');
        });
    }
};
const loadFailure =  () => {
     console.log('Failed to load data.  Check console log');
};
const reloadData = () => {
    keycloak.updateToken(10)
            .success(loadData)
            .error(() => {
                console.log('Failed to load data.  User is logged out.');
            });
}
keycloak.init({ onLoad: 'login-required' }).success(reloadData);}
      $(document).ready(function(){
        
      })
    </script>
    <title>Ma page test</title>
  </head>
  <body>
    <p>Voici ma page</p>
    <button onclick="getToken()">Token</button>
  </body>
</html>
